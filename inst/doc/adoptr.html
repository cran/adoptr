<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-06-07" />

<title>Get started with adoptr</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Get started with adoptr</h1>
<h4 class="date">2024-06-07</h4>



<div id="two-stage-designs-for-clinical-trials" class="section level2">
<h2>Two-stage designs for clinical trials</h2>
<p>In prospectively planned confirmatory clinical trials there has been
a long-standing debate about the merits of allowing pre-planned interim
analyses to stop or modify an ongoing trial, cf.Â  <a href="https://doi.org/10.1002/sim.6472">Bauer <em>et al.</em>, 2016</a>.
It is common consensus that such two-stage designs should still maintain
strict control of the maximal type one error rate despite the data
dependent decision at the interim analysis. Most authors use combination
function approaches to combine either the independent p values or test
statistics from the respective stages. Doing so with pre-specified
weights maintains the type one error rate control.</p>
<p>With <strong>adoptr</strong> we provide tools to explore optimal
two-stage designs for one or two-arm clinical trials with
(asymptotically) normally distributed and stage-wise independent test
statistics. In <a href="https://doi.org/10.1002/sim.8291">Pilz <em>et
al.</em>, 2019</a>, it was argued that such techniques are not
necessary, in fact, that they are counter-productive, since the
pre-specified weights might be sub-optimal. Instead, one may see the
problem of defining an optimal two-stage designs as a variational
problem to find the optimal configuration <span class="math display">\[
\mathcal{D}:=\big(n_1, c_1^e, c_1^f, n_2(\cdot), c_2(\cdot)\big)
\]</span> directly for a given objective function and potentially a set
of constraints. The relaxation of this mixed-integer problem to the real
numbers can then be solved with standard methods from analysis. E.g.,
one could construct an implicit solution by solving the corresponding
Euler-Lagrange equation for given first-stage and then find an optimal
first-stage configuration, cf.Â <a href="https://doi.org/10.1002/sim.8291">Pilz <em>et al.</em>, 2019</a>.
Instead, the <strong>adoptr</strong> package implements a direct
numerical solution algorithm by embedding the variation problem via a
set of pivot points in the <span class="math inline">\(\mathbb{R}^k\)</span> and solving the
corresponding finite-dimensional problem using gradient-free numerical
optimization procedures (COBYLA / nloptr).</p>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>Consider the two-arm case comparing two group means mean. Let <span class="math inline">\(\delta\)</span> be the difference in means and
assume that the aim is to reject the null hypothesis <span class="math inline">\(\mathcal{H}_0: \delta \leq 0\)</span>. Further
assume that a power of 80% at <span class="math inline">\(\delta=0.4\)</span> and a type-one-error rate of
2.5% on the boundary of the null hypothesis <span class="math inline">\(\delta\leq0.0\)</span> is required.</p>
<p>In this situation, the one-sided t-test would require a sample size
of <span class="math inline">\(51\)</span> individuals per-group. If we
were willing to accept the fact that the sample size of a two-stage
design is inherently unknown at the planning stage, we could reduce the
<em>expected</em> sample size under the alternative by optimizing a
two-stage design with respect to this quantity. Since the two-stage
design, by definition, has more degrees of freedom than the single-stage
design, it must be at least as good in terms of expected sample size as
the single-stage design - for which the expected sample size is always
51.</p>
<div id="define-hypotheses-and-data-generating-mechanism" class="section level2">
<h2>Define hypotheses and data-generating mechanism</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(adoptr)</span></code></pre></div>
<p>First, we define the null and alternative hypotheses as prior
distributions over the unknown parameter <span class="math inline">\(\delta\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>H_0 <span class="ot">&lt;-</span> <span class="fu">PointMassPrior</span>(.<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>H_1 <span class="ot">&lt;-</span> <span class="fu">PointMassPrior</span>(.<span class="dv">4</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>Next, we define the data-generating mechanism (data distribution).
Currently, normally distributed test statistics with known variance, and
the normal approximation of binary endpoints are supported. In this
example, we choose a normal distribution, i.e., assume a continuous
outcome. For an example with binomial data distribution, cf.Â the
vignette <a href="https://optad.github.io/adoptr/articles/composite-scores.html">composite
scores</a>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>datadist <span class="ot">&lt;-</span> <span class="fu">Normal</span>(<span class="at">two_armed =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="specify-optimization-problem" class="section level2">
<h2>Specify optimization problem</h2>
<p>We begin by defining the expected sample size under the alternative
hypothesis:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>ess <span class="ot">&lt;-</span> <span class="fu">ExpectedSampleSize</span>(datadist, H_1)</span></code></pre></div>
<p>Similarly, we can define the power and the type-one-error rate by
integrating conditional power with respect to the alternative or null
hypothesis respectively:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="fu">Power</span>(datadist, H_1)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>toer  <span class="ot">&lt;-</span> <span class="fu">Power</span>(datadist, H_0)</span></code></pre></div>
<p>To complete the problem specification, we only need to provide an
initial design and an integration order for the Gaussian quadrature rule
to be used for the numerical integration of the variational objective
between <span class="math inline">\(c_1^f\)</span> and <span class="math inline">\(c_1^e\)</span>. <strong>adoptr</strong> provides a
heuristic method to obtain an initial design. It is based on a one-stage
design under specific constraints on type one error rate and power.
However, it may be more efficient to use a situation-specific initial
design.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>initial_design <span class="ot">&lt;-</span> <span class="fu">get_initial_design</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="at">theta =</span> .<span class="dv">4</span>,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">alpha =</span> .<span class="dv">025</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">beta  =</span> .<span class="dv">2</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="at">type  =</span> <span class="st">&quot;two-stage&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="at">dist  =</span> datadist,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="at">order =</span> 7L</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>)</span></code></pre></div>
<p>The decision boundaries are heuristically picked in concordance with
those of the single-stage design. We can then check whether the initial
design fulfills the constraints on the operating characteristics:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">evaluate</span>(power, initial_design)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; [1] 0.9401854</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">evaluate</span>(toer, initial_design)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; [1] 0.0246875</span></span></code></pre></div>
<p>We can now proceed with defining and solving the optimization
problem:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>opt_res <span class="ot">&lt;-</span> <span class="fu">minimize</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  </span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  ess,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  </span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">subject_to</span>(</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    power <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    toer  <span class="sc">&lt;=</span> .<span class="dv">025</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  ),</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  initial_design</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>)</span></code></pre></div>
<p>Here, the default setting for the optimizer and box constraints seem
to have worked out. The numerical procedure converged after</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>opt_res<span class="sc">$</span>nloptr_return<span class="sc">$</span>iterations</span></code></pre></div>
<p>iterations.</p>
<p>We can plot the resulting optimized design may again be plotted
together with its conditional power.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  opt_res<span class="sc">$</span>design, </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="st">&quot;Conditional power&quot;</span> <span class="ot">=</span> <span class="fu">ConditionalPower</span>(datadist, H_1)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Numerical integration yields an expected sample size of</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">evaluate</span>(ess, opt_res<span class="sc">$</span>design)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; [1] 39.85632</span></span></code></pre></div>
<p>which is way below the single-stage 51. We can check this results
against simulated values</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>df_sim <span class="ot">&lt;-</span> <span class="fu">simulate</span>(</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  opt_res<span class="sc">$</span>design, </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="at">dist =</span> datadist, </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="at">theta =</span> .<span class="dv">4</span>, </span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>n <span class="ot">&lt;-</span> df_sim<span class="sc">$</span>n1 <span class="sc">+</span> df_sim<span class="sc">$</span>n2</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="fu">mean</span>(n)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; [1] 39.83996</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="fu">sd</span>(n) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(n))</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; [1] 0.01372661</span></span></code></pre></div>
<p>The values from simulation and numerical integration are almost
identical and the constraints are also met almost perfectly:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">evaluate</span>(toer, opt_res<span class="sc">$</span>design)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; [1] 0.02500571</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">evaluate</span>(power, opt_res<span class="sc">$</span>design)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; [1] 0.7985278</span></span></code></pre></div>
</div>
<div id="variations" class="section level2">
<h2>Variations</h2>
<p>The purpose of <strong>adoptr</strong> is to provide a high-level
interface for exploring and comparing different designs and to
experiment with different combinations of objective functions and
constraints. In particular, <strong>adoptr</strong> supports:</p>
<ul>
<li><p>Important predefined scores as (conditional) power or sample size
functions as well as a framework for constraints on scores (cf.Â <a href="https://optad.github.io/adoptr/articles/conditional-scores.html">conditional
scores</a>).</p></li>
<li><p>Arbitrary continuous or discrete <a href="https://optad.github.io/adoptr/articles/working-with-priors.html">prior
distributions</a> for the single location parameter <span class="math inline">\(\theta\)</span> of the test statistic.</p></li>
<li><p>Support for simple arithmetic operations on scores to quickly
define weighted sums etc. (cf.Â <a href="https://optad.github.io/adoptr/articles/composite-scores.html">composite
scores</a>).</p></li>
<li><p>Relatively flexible framework for <a href="https://optad.github.io/adoptr/articles/defining-new-scores.html">defining
new scores</a>.</p></li>
</ul>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
